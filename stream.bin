#include<stdio.h> 
#include<string.h> 
#pragma warning (disable:4996) 
typedef struct { 
 char is; 
 int cod; 
 char nume[30]; 
 char prenume[30]; 
 char dep[20]; 
 char prof[20]; 
 int varsta; 
 float sal[3]; 
 struct data { 
  int zi; 
  int luna; 
  int an; 
 } data_ang; 
} ang; 
int nr_art(FILE *f, int p) 
{ 
 int l, m; 
 l = ftell(f); 
 fseek(f, 0, 2); 
 m = ftell(f) / p; 
 fseek(f, l, 0); 
 return m; 
} 
void populare() 
{ 
 FILE *f; 
 ang a; 
 int n, i, er; 
 char nume_f[20]; 
 printf("\nnume fisier:"); 
 gets_s(nume_f); 
 f = fopen(nume_f, "wb+"); 
 int nr = sizeof(ang); 
 printf("n="); scanf_s("%d", &n); 
 while (!feof(stdin)) 
 { 
  if (n > nr_art(f, sizeof(ang))) 
  { 
   fseek(f, 0, 2); 
   a.is = 0; 
   for (i = nr_art(f, sizeof(ang)); i < n; i++) 
    fwrite(&a, sizeof(ang), 1, f); 
   fseek(f, (n - 1) * sizeof(ang), 0); 
   a.is = 1; 
   a.cod = n; 
   printf("nume="); getc(stdin); gets_s(a.nume); 
   printf("prenume="); gets_s(a.prenume); 
   printf("dep="); gets_s(a.dep); 
   printf("prof="); gets_s(a.prof); 
   printf("varsta="); scanf_s("%d", &a.varsta); 
   for (i = 0; i < 3; i++) 
   { 
    printf("sal din luna %d", i + 1); 
    scanf_s("%f", &a.sal[i]); 
   } 
   printf("data angajaraii zi, luna si an:"); 
   scanf("%d %d %d", &a.data_ang.zi, &a.data_ang.luna, &a.data_ang.an); 
   fwrite(&a, sizeof(ang), 1, f); 
  } 
  else { 
   fseek(f, (n - 1) * sizeof(ang), 0); 
   fread(&a, sizeof(ang), 1, f); 
   if (a.is == 0) { 
    a.is = 1; 
    a.cod = n; 
    printf("nume="); getc(stdin); gets_s(a.nume); 
    printf("prenume="); gets_s(a.prenume); 
    printf("dep="); gets_s(a.dep); 
    printf("prof="); gets_s(a.prof); 
    printf("varsta="); scanf_s("%d", &a.varsta); 
    for (i = 0; i < 3; i++) 
    { 
     printf("sal din luna %d", i + 1); 
     scanf_s("%f", &a.sal[i]); 
    } 
    printf("data angajaraii zi, luna si an:"); 
    scanf("%d %d %d", &a.data_ang.zi, &a.data_ang.luna, &a.data_ang.an); 
    fseek(f, (n - 1) * sizeof(ang), 0); 
    fwrite(&a, sizeof(ang), 1, f); 
   } 
   else printf("inreg. exista\n"); 
  } 
  printf("\nn="); scanf_s("%d", &n); 
 } 
 fclose(f); 
} 
void main() 
{ 
 populare(); 
}
